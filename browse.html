<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VibeZ : Browse</title>
    <link rel="stylesheet" href="FinalProject.css">
</head>
<body>
    <!-- Top part of each page, includes logo and top navigation -->
    <div id="header">
        <div id="logo">
            <a href="index.html"><img src="images/VibeZ.png"></a>
        </div>
        <div id="topnav">
            <a href="index.html">Home</a>
            <a href="mysongs.html" > My Songs </a>
            <a href="browse.html" class="active"> Browse All </a>
            <a href="speedsearch.html"> Speed Search </a>
        </div>
    </div>
        <div class="content">
            <h2> Browse Songs </h2>
            <div id="genreBar">
                
            </div>
            <div class="toggleButtonDiv">
                <button class="toggleButton" onclick="toggleGrid()">Change View</button>
            </div>
            <hr class="songs">
            <div class="songGrid" id="songGrid1">
                <!-- song card is used to display a card version of the song -->
                <!-- <div class="songCard"> -->
                    <!-- required for display, albumImage:songName:artistName:release the url for spotify is an optional thing to discuss -->
                    <!-- <img src="images/RickAstley.jpg">
                    <h3> Never Gonna Give You Up </h3>
                    <p> Rick Astley, 1987</p>
                </div> -->
            </div>
            <div id="songPages">

            </div>
        </div>
        <script>
            let currentIndex = 0;
            // fetch genres for buttons
            genreButtons();
            // fetch default songs
            getSongsByGenre(0);

            // used for page navigation
            

            function genreButtons() {
                url = "https://harmeets.sgedu.site/genre.php?=" + Date.now();
                fetch(url)
                    .then(res => res.text())
                    .then (data => 
                    {
                        let parsedData = JSON.parse(data);
                        parsedData.data.forEach(genre => {
                            document.getElementById("genreBar").insertAdjacentHTML("beforeend", "<button onclick='getSongsByGenre(" +  genre.id + ")'>" + genre.name +"</button>")
                        });
                    })
            }
            
            function toggleGrid() {
                const collection = document.getElementsByClassName("songCard");
                for (let element of collection){
                    element.classList.toggle("songLine");
                }
            }

            // reset songs and display picked genre
            function getSongsByGenre(genre){
                resetPage();
                url = "https://harmeets.sgedu.site/song.php?id=" + genre + "&?date=" + Date.now();
                updatePage(url,genre);
                currentIndex = 0;
            }

            function updatePage(url,genre){
                fetch (url)
                .then(res => res.text())
                .then (data => 
                {
                    let parsedData = JSON.parse(data);
                    parsedData.data.forEach(song => {
                        document.getElementById("songGrid1").insertAdjacentHTML("beforeend", "<div class='songCard'> <img src=' " + song.album.cover_medium + "'> <h3>" + song.title_short + "</h3> <p>" + song.artist.name + 
                            "</p> <audio controls> <source src='" + song.preview + "' type='audio/mpeg'> </audio> <button> &hearts; </button> </div>")
                    });
                    if (parsedData.prev) {
                        document.getElementById("songPages").insertAdjacentHTML("beforeend", "<button onclick='goThere(0," + genre +")'> Previous </button>");
                    }
                    if (parsedData.next) {
                        document.getElementById("songPages").insertAdjacentHTML("beforeend", "<button onclick='goThere(1," + genre +");'> Next </button>");
                    }
                })
            }

            function resetPage(){
                while (document.getElementById("songGrid1").firstChild) {
                    document.getElementById("songGrid1").removeChild(document.getElementById("songGrid1").firstChild);
                }
                while (document.getElementById("songPages").firstChild) {
                    document.getElementById("songPages").removeChild(document.getElementById("songPages").firstChild);
                }
            }

            function goThere(direction, genre){
                url = "https://harmeets.sgedu.site/goThere.php?direction=" + direction + "&genre=" + genre + "&date=" + Date.now() + "&index=" + currentIndex;
                if (direction == 1){
                    currentIndex = currentIndex + 12;
                }
                else {
                    currentIndex = currentIndex - 12;
                }
                resetPage();
                updatePage(url,genre);
                
            }
            </script>
</body>

</html>
